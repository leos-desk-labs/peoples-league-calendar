<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Peoples League | Content Calendar</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root {
      --pl-lime: #e7ff01;
      --pl-lime-hover: #d4eb00;
      --pl-lime-muted: rgba(231, 255, 1, 0.15);
      --pl-teal: #183539;
      --pl-teal-light: #264747;
      --pl-cyan: #52e3d4;
      --pl-purple: #350097;
      --bg-primary: #0d1117;
      --bg-secondary: #161b22;
      --bg-tertiary: #21262d;
      --bg-card: #1c2128;
      --bg-hover: #262c34;
      --text-primary: #f0f6fc;
      --text-secondary: #8b949e;
      --text-muted: #6e7681;
      --border-default: #30363d;
      --border-muted: #21262d;
      --status-idea: #8b5cf6;
      --status-scheduled: #3b82f6;
      --status-production: #f59e0b;
      --status-editing: #ec4899;
      --status-review: #06b6d4;
      --status-ready: #10b981;
      --status-published: var(--pl-lime);
      --type-long: #3b82f6;
      --type-short: #f59e0b;
      --space-xs: 4px;
      --space-sm: 8px;
      --space-md: 16px;
      --space-lg: 24px;
      --space-xl: 32px;
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --transition-fast: 150ms ease;
      --transition-base: 200ms ease;
      --font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      --sidebar-width: 240px;
      --header-height: 60px;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { font-size: 16px; -webkit-font-smoothing: antialiased; }
    body { font-family: var(--font-family); font-size: 14px; line-height: 1.5; color: var(--text-primary); background-color: var(--bg-primary); min-height: 100vh; }
    #root { min-height: 100vh; }
    button { font-family: inherit; cursor: pointer; border: none; background: none; }
    input, textarea, select { font-family: inherit; font-size: inherit; }
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: var(--bg-secondary); }
    ::-webkit-scrollbar-thumb { background: var(--border-default); border-radius: 4px; }
    :focus-visible { outline: 2px solid var(--pl-lime); outline-offset: 2px; }
    .app { display: flex; min-height: 100vh; }
    .main-content { flex: 1; margin-left: var(--sidebar-width); padding-top: var(--header-height); }
    .page-content { padding: var(--space-lg); }

    /* Auth Page */
    .auth-page { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--bg-primary) 0%, var(--pl-teal) 100%); }
    .auth-container { background: var(--bg-secondary); border: 1px solid var(--border-default); border-radius: var(--radius-lg); padding: var(--space-xl); width: 100%; max-width: 400px; }
    .auth-header { text-align: center; margin-bottom: var(--space-xl); }
    .auth-header h1 { font-size: 20px; font-weight: 600; color: var(--pl-lime); margin-top: var(--space-md); }
    .auth-header p { font-size: 13px; color: var(--text-secondary); margin-top: var(--space-xs); }
    .auth-form { display: flex; flex-direction: column; gap: var(--space-md); }
    .auth-tabs { display: flex; gap: var(--space-xs); background: var(--bg-tertiary); padding: var(--space-xs); border-radius: var(--radius-md); margin-bottom: var(--space-md); }
    .auth-tab { flex: 1; padding: var(--space-sm) var(--space-md); border-radius: var(--radius-sm); font-size: 14px; font-weight: 500; color: var(--text-secondary); text-align: center; }
    .auth-tab:hover { color: var(--text-primary); }
    .auth-tab.active { background: var(--bg-card); color: var(--text-primary); }
    .auth-error { background: rgba(248, 81, 73, 0.1); border: 1px solid #f85149; border-radius: var(--radius-md); padding: var(--space-sm) var(--space-md); color: #f85149; font-size: 13px; }
    .auth-success { background: rgba(16, 185, 129, 0.1); border: 1px solid #10b981; border-radius: var(--radius-md); padding: var(--space-sm) var(--space-md); color: #10b981; font-size: 13px; }

    /* Sidebar */
    .sidebar { position: fixed; left: 0; top: 0; bottom: 0; width: var(--sidebar-width); background: var(--bg-secondary); border-right: 1px solid var(--border-default); display: flex; flex-direction: column; z-index: 200; }
    .sidebar-brand { display: flex; align-items: center; gap: var(--space-sm); padding: var(--space-md); border-bottom: 1px solid var(--border-default); }
    .sidebar-brand-text { display: flex; flex-direction: column; }
    .sidebar-brand-name { font-size: 14px; font-weight: 700; color: var(--pl-lime); }
    .sidebar-brand-tagline { font-size: 11px; color: var(--text-muted); }
    .sidebar-nav { padding: var(--space-md); display: flex; flex-direction: column; gap: var(--space-xs); }
    .sidebar-nav-item { display: flex; align-items: center; gap: var(--space-sm); padding: var(--space-sm) var(--space-md); border-radius: var(--radius-md); color: var(--text-secondary); transition: all var(--transition-fast); width: 100%; text-align: left; }
    .sidebar-nav-item:hover { background: var(--bg-tertiary); color: var(--text-primary); }
    .sidebar-nav-item.active { background: var(--pl-lime-muted); color: var(--pl-lime); }
    .sidebar-nav-icon { display: flex; width: 20px; height: 20px; }
    .sidebar-nav-label { flex: 1; font-size: 14px; font-weight: 500; }
    .sidebar-nav-count { font-size: 11px; font-weight: 600; background: var(--bg-tertiary); padding: 2px 6px; border-radius: var(--radius-sm); }
    .sidebar-nav-item.active .sidebar-nav-count { background: var(--pl-lime); color: var(--pl-teal); }
    .sidebar-section { padding: var(--space-md); margin-top: auto; border-top: 1px solid var(--border-default); }
    .sidebar-section-title { font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: var(--space-sm); }
    .sidebar-type-item { display: flex; align-items: center; gap: var(--space-sm); font-size: 13px; color: var(--text-secondary); margin-bottom: 4px; }
    .sidebar-type-dot { width: 8px; height: 8px; border-radius: 50%; }
    .sidebar-user { padding: var(--space-md); border-top: 1px solid var(--border-default); }
    .sidebar-user-info { display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-sm); }
    .sidebar-user-avatar { width: 32px; height: 32px; border-radius: 50%; background: var(--pl-lime); color: var(--pl-teal); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; }
    .sidebar-user-email { flex: 1; font-size: 12px; color: var(--text-secondary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

    /* Header */
    .header { position: fixed; top: 0; left: var(--sidebar-width); right: 0; height: var(--header-height); background: var(--bg-secondary); border-bottom: 1px solid var(--border-default); display: flex; align-items: center; justify-content: space-between; padding: 0 var(--space-lg); z-index: 100; }
    .header-left { display: flex; align-items: center; gap: var(--space-lg); }
    .header-logo { display: flex; align-items: center; gap: var(--space-sm); }
    .header-title { font-size: 16px; font-weight: 600; }
    .header-right { display: flex; align-items: center; gap: var(--space-sm); }

    /* Buttons */
    .btn { display: inline-flex; align-items: center; justify-content: center; gap: var(--space-sm); font-weight: 500; border-radius: var(--radius-md); transition: all var(--transition-fast); white-space: nowrap; }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn-sm { padding: var(--space-xs) var(--space-sm); font-size: 13px; }
    .btn-md { padding: var(--space-sm) var(--space-md); font-size: 14px; }
    .btn-default { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-default); }
    .btn-default:hover:not(:disabled) { background: var(--bg-hover); border-color: var(--text-muted); }
    .btn-primary { background: var(--pl-lime); color: var(--pl-teal); }
    .btn-primary:hover:not(:disabled) { background: var(--pl-lime-hover); }
    .btn-ghost { background: transparent; color: var(--text-secondary); }
    .btn-ghost:hover:not(:disabled) { background: var(--bg-tertiary); color: var(--text-primary); }
    .btn-danger { background: transparent; color: #f85149; border: 1px solid #f85149; }
    .btn-danger:hover:not(:disabled) { background: rgba(248, 81, 73, 0.1); }

    /* Badge */
    .badge { display: inline-flex; align-items: center; font-weight: 500; border-radius: var(--radius-sm); padding: 2px 6px; font-size: 11px; }
    .badge-type-long { background: rgba(59, 130, 246, 0.15); color: var(--type-long); }
    .badge-type-short { background: rgba(245, 158, 11, 0.15); color: var(--type-short); }

    /* Modal */
    .modal-backdrop { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.7); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: var(--space-lg); }
    .modal { background: var(--bg-secondary); border-radius: var(--radius-lg); border: 1px solid var(--border-default); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4); max-height: calc(100vh - 96px); display: flex; flex-direction: column; width: 100%; max-width: 560px; }
    .modal-header { display: flex; align-items: center; justify-content: space-between; padding: var(--space-md) var(--space-lg); border-bottom: 1px solid var(--border-default); }
    .modal-title { font-size: 16px; font-weight: 600; }
    .modal-body { padding: var(--space-lg); overflow-y: auto; }

    /* Form */
    .form-group { display: flex; flex-direction: column; gap: var(--space-xs); margin-bottom: var(--space-md); }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-md); }
    .form-label { font-size: 13px; font-weight: 500; color: var(--text-secondary); }
    .form-input, .form-textarea, .form-select { padding: var(--space-sm) var(--space-md); background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: var(--radius-md); color: var(--text-primary); font-size: 14px; }
    .form-input:focus, .form-textarea:focus, .form-select:focus { outline: none; border-color: var(--pl-lime); }
    .form-textarea { resize: vertical; min-height: 60px; }
    .form-type-toggle { display: flex; gap: var(--space-xs); }
    .form-type-btn { flex: 1; padding: var(--space-sm) var(--space-md); background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: var(--radius-md); color: var(--text-secondary); font-size: 13px; font-weight: 500; }
    .form-type-btn:hover { border-color: var(--text-muted); }
    .form-type-btn.active.long { background: rgba(59, 130, 246, 0.15); border-color: var(--type-long); color: var(--type-long); }
    .form-type-btn.active.short { background: rgba(245, 158, 11, 0.15); border-color: var(--type-short); color: var(--type-short); }
    .form-tags { display: flex; flex-wrap: wrap; gap: var(--space-xs); }
    .form-tag { padding: var(--space-xs) var(--space-sm); background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: var(--radius-sm); color: var(--text-secondary); font-size: 13px; }
    .form-tag:hover { border-color: var(--text-muted); }
    .form-tag.active { background: var(--pl-lime-muted); border-color: var(--pl-lime); color: var(--pl-lime); }
    .form-actions { display: flex; justify-content: space-between; align-items: center; margin-top: var(--space-md); padding-top: var(--space-md); border-top: 1px solid var(--border-default); }
    .form-actions-right { display: flex; gap: var(--space-sm); margin-left: auto; }

    /* Pipeline */
    .pipeline-board { display: flex; flex-direction: column; height: calc(100vh - var(--header-height) - 48px); }
    .pipeline-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-lg); flex-shrink: 0; }
    .pipeline-filters { display: flex; gap: var(--space-xs); background: var(--bg-secondary); padding: var(--space-xs); border-radius: var(--radius-md); }
    .pipeline-filter { padding: var(--space-sm) var(--space-md); border-radius: var(--radius-sm); font-size: 13px; font-weight: 500; color: var(--text-secondary); }
    .pipeline-filter:hover { color: var(--text-primary); }
    .pipeline-filter.active { background: var(--bg-tertiary); color: var(--text-primary); }
    .pipeline-filter.long.active { background: rgba(59, 130, 246, 0.15); color: var(--type-long); }
    .pipeline-filter.short.active { background: rgba(245, 158, 11, 0.15); color: var(--type-short); }
    .pipeline-columns { display: flex; gap: var(--space-md); overflow-x: auto; padding-bottom: var(--space-md); flex: 1; min-height: 0; }
    .pipeline-column { flex: 0 0 280px; min-width: 280px; background: var(--bg-secondary); border-radius: var(--radius-lg); display: flex; flex-direction: column; max-height: 100%; }
    .pipeline-column-header { display: flex; align-items: center; gap: var(--space-sm); padding: var(--space-md); border-bottom: 1px solid var(--border-default); }
    .pipeline-column-dot { width: 10px; height: 10px; border-radius: 50%; }
    .pipeline-column-title { font-size: 13px; font-weight: 600; flex: 1; }
    .pipeline-column-count { font-size: 11px; font-weight: 600; color: var(--text-muted); background: var(--bg-tertiary); padding: 2px 8px; border-radius: var(--radius-sm); }
    .pipeline-column-content { padding: var(--space-sm); display: flex; flex-direction: column; gap: var(--space-sm); overflow-y: auto; flex: 1; }
    .pipeline-empty { text-align: center; padding: var(--space-lg); color: var(--text-muted); font-size: 13px; }
    .pipeline-card-wrapper { position: relative; }
    .pipeline-card-actions { position: absolute; bottom: var(--space-sm); right: var(--space-sm); display: flex; gap: var(--space-xs); opacity: 0; transition: opacity var(--transition-fast); }
    .pipeline-card-wrapper:hover .pipeline-card-actions { opacity: 1; }
    .pipeline-move-btn { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: var(--radius-sm); color: var(--text-secondary); }
    .pipeline-move-btn:hover { background: var(--bg-hover); color: var(--text-primary); }
    .pipeline-move-btn.forward:hover { background: var(--pl-lime-muted); color: var(--pl-lime); border-color: var(--pl-lime); }

    /* Drag and Drop */
    .pipeline-column.drag-over { background: var(--bg-tertiary); border: 2px dashed var(--pl-lime); }
    .pipeline-column.drag-over .pipeline-column-content { background: var(--pl-lime-muted); }
    .content-card.dragging { opacity: 0.5; transform: rotate(2deg); cursor: grabbing; }
    .content-card[draggable="true"] { cursor: grab; }
    .content-card[draggable="true"]:active { cursor: grabbing; }
    .drag-placeholder { background: var(--pl-lime-muted); border: 2px dashed var(--pl-lime); border-radius: var(--radius-md); min-height: 80px; margin-bottom: var(--space-sm); }

    /* Content Card */
    .content-card { position: relative; background: var(--bg-card); border: 1px solid var(--border-default); border-radius: var(--radius-md); padding: var(--space-md); cursor: pointer; transition: all var(--transition-fast); overflow: hidden; }
    .content-card:hover { border-color: var(--text-muted); transform: translateY(-1px); box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3); }
    .content-card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-sm); }
    .content-card-assignee { font-size: 11px; color: var(--text-muted); }
    .content-card-title { font-size: 14px; font-weight: 600; margin-bottom: var(--space-xs); line-height: 1.3; }
    .content-card-desc { font-size: 13px; color: var(--text-secondary); margin-bottom: var(--space-sm); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .content-card-footer { display: flex; flex-direction: column; gap: var(--space-sm); }
    .content-card-dates { display: flex; flex-direction: column; gap: var(--space-xs); }
    .content-card-date { display: flex; align-items: center; gap: var(--space-xs); font-size: 11px; color: var(--text-muted); }
    .content-card-date.release { color: var(--pl-lime); }
    .content-card-tags { display: flex; flex-wrap: wrap; gap: var(--space-xs); }
    .content-card-tag { font-size: 11px; padding: 2px 6px; background: var(--bg-tertiary); border-radius: var(--radius-sm); color: var(--text-secondary); }
    .content-card-stage-indicator { position: absolute; left: 0; top: 0; bottom: 0; width: 3px; }
    .content-card-meta { font-size: 10px; color: var(--text-muted); margin-top: var(--space-xs); padding-top: var(--space-xs); border-top: 1px solid var(--border-muted); display: flex; align-items: center; gap: 4px; }

    /* Calendar */
    .calendar-container { display: flex; flex-direction: column; gap: var(--space-md); }
    .calendar-view-toggle { display: flex; gap: var(--space-xs); background: var(--bg-secondary); padding: var(--space-xs); border-radius: var(--radius-md); width: fit-content; }
    .calendar-toggle-btn { padding: var(--space-sm) var(--space-md); border-radius: var(--radius-sm); font-size: 13px; font-weight: 500; color: var(--text-secondary); }
    .calendar-toggle-btn:hover { color: var(--text-primary); }
    .calendar-toggle-btn.active { background: var(--bg-tertiary); color: var(--text-primary); }
    .month-view { display: flex; flex-direction: column; gap: var(--space-md); }
    .month-header { display: flex; justify-content: space-between; align-items: center; }
    .month-nav { display: flex; align-items: center; gap: var(--space-sm); }
    .month-title { font-size: 20px; font-weight: 600; min-width: 180px; text-align: center; }
    .month-actions { display: flex; gap: var(--space-sm); }
    .month-legend { display: flex; gap: var(--space-lg); }
    .month-legend-item { display: flex; align-items: center; gap: var(--space-xs); font-size: 13px; color: var(--text-secondary); }
    .month-legend-dot { width: 8px; height: 8px; border-radius: 50%; }
    .month-legend-dot.shoot { background: var(--type-long); }
    .month-legend-dot.release { background: var(--pl-lime); }
    .month-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: var(--border-default); border-radius: var(--radius-lg); overflow: hidden; }
    .month-weekday { background: var(--bg-tertiary); padding: var(--space-sm); text-align: center; font-size: 13px; font-weight: 600; color: var(--text-secondary); }
    .calendar-day { min-height: 100px; background: var(--bg-secondary); border: 1px solid transparent; padding: var(--space-xs); cursor: pointer; }
    .calendar-day:hover { background: var(--bg-tertiary); }
    .calendar-day.outside { opacity: 0.4; }
    .calendar-day.today { border-color: var(--pl-lime); }
    .calendar-day.today .calendar-day-number { background: var(--pl-lime); color: var(--pl-teal); }
    .calendar-day-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-xs); }
    .calendar-day-number { font-size: 13px; font-weight: 500; color: var(--text-secondary); width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 50%; }
    .calendar-day-dots { display: flex; gap: 3px; }
    .calendar-dot { width: 6px; height: 6px; border-radius: 50%; }
    .calendar-dot.shoot { background: var(--type-long); }
    .calendar-dot.release { background: var(--pl-lime); }
    .calendar-day-content { display: flex; flex-direction: column; gap: 2px; }
    .calendar-event { font-size: 11px; padding: 2px 4px; border-radius: var(--radius-sm); display: flex; gap: 4px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
    .calendar-event.shoot { background: rgba(59, 130, 246, 0.15); color: var(--type-long); }
    .calendar-event.release { background: var(--pl-lime-muted); color: var(--pl-lime); }
    .calendar-event-label { font-weight: 500; flex-shrink: 0; }
    .calendar-event-title { overflow: hidden; text-overflow: ellipsis; }

    /* Ideas */
    .ideas-bank { display: flex; flex-direction: column; gap: var(--space-lg); }
    .ideas-header { display: flex; justify-content: space-between; align-items: flex-start; }
    .ideas-title { font-size: 20px; font-weight: 600; margin-bottom: var(--space-xs); }
    .ideas-subtitle { font-size: 13px; color: var(--text-secondary); }
    .ideas-form { background: var(--bg-secondary); border: 1px solid var(--border-default); border-radius: var(--radius-lg); padding: var(--space-lg); display: flex; flex-direction: column; gap: var(--space-md); }
    .ideas-form-row { display: flex; gap: var(--space-md); }
    .ideas-form-input { flex: 1; padding: var(--space-sm) var(--space-md); background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: var(--radius-md); color: var(--text-primary); font-size: 14px; }
    .ideas-form-input:focus { outline: none; border-color: var(--pl-lime); }
    .ideas-form-type { display: flex; gap: var(--space-xs); }
    .ideas-type-btn { padding: var(--space-sm) var(--space-md); background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: var(--radius-md); color: var(--text-secondary); font-size: 13px; font-weight: 500; }
    .ideas-type-btn:hover { border-color: var(--text-muted); }
    .ideas-type-btn.active.long { background: rgba(59, 130, 246, 0.15); border-color: var(--type-long); color: var(--type-long); }
    .ideas-type-btn.active.short { background: rgba(245, 158, 11, 0.15); border-color: var(--type-short); color: var(--type-short); }
    .ideas-form-textarea { padding: var(--space-sm) var(--space-md); background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: var(--radius-md); color: var(--text-primary); font-size: 14px; resize: vertical; min-height: 60px; width: 100%; }
    .ideas-form-textarea:focus { outline: none; border-color: var(--pl-lime); }
    .ideas-form-tags { display: flex; flex-wrap: wrap; gap: var(--space-xs); }
    .ideas-tag-btn { padding: var(--space-xs) var(--space-sm); background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: var(--radius-sm); color: var(--text-secondary); font-size: 13px; }
    .ideas-tag-btn:hover { border-color: var(--text-muted); }
    .ideas-tag-btn.active { background: var(--pl-lime-muted); border-color: var(--pl-lime); color: var(--pl-lime); }
    .ideas-form-actions { display: flex; justify-content: flex-end; gap: var(--space-sm); }
    .ideas-sections { display: flex; flex-direction: column; gap: var(--space-xl); }
    .ideas-section-title { display: flex; align-items: center; gap: var(--space-sm); font-size: 14px; font-weight: 600; margin-bottom: var(--space-md); }
    .ideas-section-dot { width: 10px; height: 10px; border-radius: 50%; }
    .ideas-section-dot.short { background: var(--type-short); }
    .ideas-section-dot.long { background: var(--type-long); }
    .ideas-section-count { font-size: 11px; font-weight: 600; color: var(--text-muted); background: var(--bg-tertiary); padding: 2px 8px; border-radius: var(--radius-sm); margin-left: auto; }
    .ideas-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: var(--space-md); }
    .ideas-empty { grid-column: 1 / -1; text-align: center; padding: var(--space-xl); color: var(--text-muted); font-size: 13px; background: var(--bg-secondary); border-radius: var(--radius-lg); border: 1px dashed var(--border-default); }
    .idea-card { background: var(--bg-card); border: 1px solid var(--border-default); border-radius: var(--radius-md); padding: var(--space-md); }
    .idea-card:hover { border-color: var(--text-muted); }
    .idea-card-header { margin-bottom: var(--space-sm); }
    .idea-card-title { font-size: 14px; font-weight: 600; margin-bottom: var(--space-xs); }
    .idea-card-desc { font-size: 13px; color: var(--text-secondary); margin-bottom: var(--space-sm); line-height: 1.4; }
    .idea-card-tags { display: flex; flex-wrap: wrap; gap: var(--space-xs); margin-bottom: var(--space-sm); }
    .idea-card-tag { font-size: 11px; padding: 2px 6px; background: var(--bg-tertiary); border-radius: var(--radius-sm); color: var(--text-secondary); }
    .idea-card-actions { display: flex; justify-content: space-between; align-items: center; padding-top: var(--space-sm); border-top: 1px solid var(--border-default); }

    /* Loading */
    .loading-spinner { display: inline-block; width: 20px; height: 20px; border: 2px solid var(--border-default); border-radius: 50%; border-top-color: var(--pl-lime); animation: spin 1s ease-in-out infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-page { min-height: 100vh; display: flex; align-items: center; justify-content: center; flex-direction: column; gap: var(--space-md); }
    .loading-page p { color: var(--text-secondary); }

    /* Logo Upload Menu */
    .logo-container { position: relative; }
    .logo-menu { position: absolute; top: 100%; left: 0; margin-top: var(--space-xs); background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: var(--radius-md); padding: var(--space-xs); z-index: 1000; min-width: 140px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); }
    .logo-menu button { display: block; width: 100%; text-align: left; padding: var(--space-sm) var(--space-md); color: var(--text-primary); font-size: 13px; border-radius: var(--radius-sm); transition: background var(--transition-fast); }
    .logo-menu button:hover { background: var(--bg-hover); }

    /* Avatar Menu */
    .avatar-menu { position: absolute; top: 100%; left: 50%; transform: translateX(-50%); margin-top: var(--space-xs); background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: var(--radius-md); padding: var(--space-xs); z-index: 1000; min-width: 130px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); }
    .avatar-menu button { display: block; width: 100%; text-align: left; padding: var(--space-sm) var(--space-md); color: var(--text-primary); font-size: 12px; border-radius: var(--radius-sm); transition: background var(--transition-fast); white-space: nowrap; }
    .avatar-menu button:hover { background: var(--bg-hover); }

    /* Admin Portal */
    .admin-portal { padding: var(--space-lg); }
    .admin-header { margin-bottom: var(--space-xl); }
    .admin-header h2 { font-size: 20px; font-weight: 600; margin-bottom: var(--space-xs); }
    .admin-header p { font-size: 13px; color: var(--text-secondary); }
    .admin-section { background: var(--bg-secondary); border: 1px solid var(--border-default); border-radius: var(--radius-lg); padding: var(--space-lg); margin-bottom: var(--space-lg); }
    .admin-section h3 { font-size: 14px; font-weight: 600; margin-bottom: var(--space-md); color: var(--text-primary); }
    .admin-form { display: flex; flex-direction: column; gap: var(--space-md); }
    .admin-empty { font-size: 13px; color: var(--text-muted); }
    .admin-team-list { display: flex; flex-direction: column; gap: var(--space-sm); }
    .admin-team-member { display: flex; align-items: center; gap: var(--space-sm); padding: var(--space-sm); background: var(--bg-tertiary); border-radius: var(--radius-md); }
    .admin-team-email { flex: 1; font-size: 13px; color: var(--text-primary); overflow: hidden; text-overflow: ellipsis; }
    .admin-nav-item { display: flex; align-items: center; gap: var(--space-sm); padding: var(--space-sm) var(--space-md); border-radius: var(--radius-md); color: var(--text-secondary); transition: all var(--transition-fast); width: 100%; text-align: left; margin-top: var(--space-xs); }
    .admin-nav-item:hover { background: var(--bg-tertiary); color: var(--text-primary); }
    .admin-nav-item.active { background: rgba(139, 92, 246, 0.15); color: #a78bfa; }

    /* Help Guide */
    .help-guide { height: calc(100vh - var(--header-height) - 48px); display: flex; flex-direction: column; }
    .help-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--space-lg); }
    .help-header h2 { font-size: 20px; font-weight: 600; margin-bottom: var(--space-xs); }
    .help-header p { font-size: 13px; color: var(--text-secondary); }
    .help-nav { display: flex; gap: var(--space-xs); background: var(--bg-secondary); padding: var(--space-xs); border-radius: var(--radius-md); margin-bottom: var(--space-lg); flex-wrap: wrap; }
    .help-nav-btn { padding: var(--space-sm) var(--space-md); border-radius: var(--radius-sm); font-size: 13px; font-weight: 500; color: var(--text-secondary); transition: all var(--transition-fast); }
    .help-nav-btn:hover { color: var(--text-primary); }
    .help-nav-btn.active { background: var(--bg-tertiary); color: var(--pl-lime); }
    .help-content { flex: 1; overflow-y: auto; padding-right: var(--space-sm); }
    .help-section h3 { font-size: 18px; font-weight: 600; margin-bottom: var(--space-sm); color: var(--text-primary); }
    .help-section > p { font-size: 14px; color: var(--text-secondary); margin-bottom: var(--space-lg); line-height: 1.6; }
    .help-card { background: var(--bg-secondary); border: 1px solid var(--border-default); border-radius: var(--radius-lg); padding: var(--space-lg); margin-bottom: var(--space-md); }
    .help-card h4 { font-size: 14px; font-weight: 600; margin-bottom: var(--space-sm); color: var(--text-primary); }
    .help-card p { font-size: 13px; color: var(--text-secondary); margin-bottom: var(--space-sm); line-height: 1.5; }
    .help-card ul, .help-card ol { margin: 0; padding-left: var(--space-lg); }
    .help-card li { font-size: 13px; color: var(--text-secondary); margin-bottom: var(--space-xs); line-height: 1.5; }
    .help-card li strong { color: var(--text-primary); }
    .help-stages { list-style: none; padding-left: 0; }
    .help-stages li { display: flex; align-items: center; gap: var(--space-sm); padding: var(--space-xs) 0; }
    .help-stage-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
    .help-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: var(--space-xs); }
    .help-role { border-left: 3px solid var(--pl-lime); }
    .help-role h4 { font-size: 15px; }
    .help-role > p { font-size: 12px; color: var(--pl-lime); margin-bottom: var(--space-md); font-weight: 500; }
    .help-btn { display: flex; align-items: center; gap: var(--space-sm); padding: var(--space-sm) var(--space-md); border-radius: var(--radius-md); color: var(--text-secondary); transition: all var(--transition-fast); width: 100%; text-align: left; font-size: 13px; }
    .help-btn:hover { background: var(--bg-tertiary); color: var(--text-primary); }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef, createContext, useContext } = React;

    // Supabase Configuration
    const SUPABASE_URL = 'https://ycqysghmfdwohjjvxgyv.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InljcXlzZ2htZmR3b2hqanZ4Z3l2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwMTU4MTYsImV4cCI6MjA4MzU5MTgxNn0.DHpIQx2eK9Q55pGOrNOgB5T-A7nkKe370qOE-oBm89w';

    // Create Supabase client with persistent local storage for 7-day sessions
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: {
        persistSession: true,
        storageKey: 'pl-auth-token',
        storage: window.localStorage,
        autoRefreshToken: true,
        detectSessionInUrl: false,
      }
    });

    // Session expiry check - 7 days (in milliseconds)
    const SESSION_DURATION = 7 * 24 * 60 * 60 * 1000;

    // Auth Context
    const AuthContext = createContext(null);

    function useAuth() {
      return useContext(AuthContext);
    }


    // Profile Pictures Context - stores user profile pics in Supabase Storage
    const ProfilePicsContext = createContext(null);

    function useProfilePics() {
      return useContext(ProfilePicsContext);
    }

    function ProfilePicsProvider({ children }) {
      const [profilePics, setProfilePics] = useState({});
      const [loading, setLoading] = useState(true);

      // Load all profile pics from Supabase on mount
      useEffect(() => {
        // Delay loading to ensure supabase is ready
        const timer = setTimeout(() => {
          loadAllProfilePics();
        }, 500);
        return () => clearTimeout(timer);
      }, []);

      const loadAllProfilePics = async () => {
        try {
          // Check if supabase storage is available
          if (!supabase?.storage) {
            console.warn('Supabase storage not available');
            setLoading(false);
            return;
          }

          // List all files in the profile-pics bucket
          const { data: files, error } = await supabase.storage
            .from('profile-pics')
            .list('', { limit: 100 });

          if (error) {
            // Don't break the app if storage isn't set up yet
            console.warn('Profile pics storage not available:', error.message);
            setLoading(false);
            return;
          }

          // Get public URLs for each file
          const pics = {};
          for (const file of files || []) {
            if (file.name && !file.name.startsWith('.')) {
              const { data } = supabase.storage
                .from('profile-pics')
                .getPublicUrl(file.name);
              // Extract email from filename (filename is email with @ replaced by _at_)
              const email = file.name.replace('.jpg', '').replace('_at_', '@');
              pics[email] = data.publicUrl + '?t=' + Date.now(); // Cache bust
            }
          }
          setProfilePics(pics);
        } catch (err) {
          console.warn('Error loading profile pics:', err);
        }
        setLoading(false);
      };

      const uploadProfilePic = async (email, file) => {
        try {
          // Create a safe filename from email
          const fileName = email.replace('@', '_at_') + '.jpg';

          // Upload to Supabase Storage
          const { data, error } = await supabase.storage
            .from('profile-pics')
            .upload(fileName, file, {
              cacheControl: '3600',
              upsert: true // Overwrite if exists
            });

          if (error) throw error;

          // Get the public URL
          const { data: urlData } = supabase.storage
            .from('profile-pics')
            .getPublicUrl(fileName);

          const publicUrl = urlData.publicUrl + '?t=' + Date.now();

          // Update local state
          setProfilePics(prev => ({ ...prev, [email]: publicUrl }));

          return publicUrl;
        } catch (err) {
          console.error('Error uploading profile pic:', err);
          throw new Error('Failed to upload profile picture');
        }
      };

      const getProfilePic = (email) => {
        return profilePics[email] || null;
      };

      const clearProfilePic = async (email) => {
        try {
          const fileName = email.replace('@', '_at_') + '.jpg';
          await supabase.storage
            .from('profile-pics')
            .remove([fileName]);

          setProfilePics(prev => {
            const updated = { ...prev };
            delete updated[email];
            return updated;
          });
        } catch (err) {
          console.warn('Error clearing profile pic:', err);
        }
      };

      return (
        <ProfilePicsContext.Provider value={{ profilePics, uploadProfilePic, getProfilePic, clearProfilePic, loading, refreshPics: loadAllProfilePics }}>
          {children}
        </ProfilePicsContext.Provider>
      );
    }

    // Read Status Context - tracks what each user has seen
    const ReadStatusContext = createContext(null);

    function useReadStatus() {
      return useContext(ReadStatusContext);
    }

    function ReadStatusProvider({ children }) {
      // Store read timestamps per user: { "user@email.com": { lastViewedPipeline: timestamp, lastViewedIdeas: timestamp, readContentIds: [], readIdeaIds: [] } }
      const [readStatus, setReadStatus] = useState(() => {
        try {
          return JSON.parse(localStorage.getItem('pl-read-status') || '{}');
        } catch {
          return {};
        }
      });

      useEffect(() => {
        try {
          localStorage.setItem('pl-read-status', JSON.stringify(readStatus));
        } catch (err) {
          console.warn('Error saving read status:', err);
        }
      }, [readStatus]);

      const getUserStatus = (email) => {
        if (!email) return { readContentIds: [], readIdeaIds: [], lastViewedPipeline: 0, lastViewedIdeas: 0 };
        return readStatus[email] || { readContentIds: [], readIdeaIds: [], lastViewedPipeline: 0, lastViewedIdeas: 0 };
      };

      const markContentRead = (email, contentIds) => {
        if (!email) return;
        setReadStatus(prev => {
          const userStatus = prev[email] || { readContentIds: [], readIdeaIds: [], lastViewedPipeline: 0, lastViewedIdeas: 0 };
          const newReadIds = [...new Set([...userStatus.readContentIds, ...contentIds])];
          return {
            ...prev,
            [email]: {
              ...userStatus,
              readContentIds: newReadIds,
              lastViewedPipeline: Date.now()
            }
          };
        });
      };

      const markIdeasRead = (email, ideaIds) => {
        if (!email) return;
        setReadStatus(prev => {
          const userStatus = prev[email] || { readContentIds: [], readIdeaIds: [], lastViewedPipeline: 0, lastViewedIdeas: 0 };
          const newReadIds = [...new Set([...userStatus.readIdeaIds, ...ideaIds])];
          return {
            ...prev,
            [email]: {
              ...userStatus,
              readIdeaIds: newReadIds,
              lastViewedIdeas: Date.now()
            }
          };
        });
      };

      const getUnreadContentCount = (email, content) => {
        if (!email || !content) return 0;
        const userStatus = getUserStatus(email);
        // Count content items that are NOT in the user's read list and are not published
        return content.filter(c =>
          c.stage !== 'published' &&
          !userStatus.readContentIds.includes(c.id)
        ).length;
      };

      const getUnreadIdeasCount = (email, ideas) => {
        if (!email || !ideas) return 0;
        const userStatus = getUserStatus(email);
        return ideas.filter(idea => !userStatus.readIdeaIds.includes(idea.id)).length;
      };

      return (
        <ReadStatusContext.Provider value={{
          getUserStatus,
          markContentRead,
          markIdeasRead,
          getUnreadContentCount,
          getUnreadIdeasCount
        }}>
          {children}
        </ReadStatusContext.Provider>
      );
    }

    // Admin emails - add your admin email(s) here
    // UPDATE THIS WITH YOUR EMAIL
    const ADMIN_EMAILS = ['clay@thepeoplesleague.golf'];

    function AuthProvider({ children }) {
      const [user, setUser] = useState(null);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        // Check active session and verify it hasn't expired (7 days)
        const checkSession = async () => {
          const { data: { session } } = await supabase.auth.getSession();

          if (session) {
            // Check if login timestamp exists and is within 7 days
            const loginTime = localStorage.getItem('pl-login-timestamp');
            const now = Date.now();

            if (loginTime && (now - parseInt(loginTime)) > SESSION_DURATION) {
              // Session expired after 7 days - sign out
              await supabase.auth.signOut();
              localStorage.removeItem('pl-login-timestamp');
              setUser(null);
            } else {
              setUser(session.user);
            }
          } else {
            setUser(null);
          }
          setLoading(false);
        };

        checkSession();

        // Listen for auth changes
        const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
          if (_event === 'SIGNED_OUT') {
            localStorage.removeItem('pl-login-timestamp');
          }
          setUser(session?.user ?? null);
        });

        return () => subscription.unsubscribe();
      }, []);

      // Send OTP code to email
      const sendOTP = async (email) => {
        const { data, error } = await supabase.auth.signInWithOtp({
          email,
          options: {
            shouldCreateUser: false, // Don't auto-create users - admin must add them
          }
        });
        return { data, error };
      };

      // Verify OTP code
      const verifyOTP = async (email, token) => {
        const { data, error } = await supabase.auth.verifyOtp({
          email,
          token,
          type: 'email'
        });
        if (!error && data.session) {
          // Store login timestamp for 7-day session tracking
          localStorage.setItem('pl-login-timestamp', Date.now().toString());
        }
        return { data, error };
      };

      // Admin function to create new user (sends them an invite)
      const inviteUser = async (email) => {
        const { data, error } = await supabase.auth.signInWithOtp({
          email,
          options: {
            shouldCreateUser: true, // Create user if doesn't exist
          }
        });
        return { data, error };
      };

      const signOut = async () => {
        localStorage.removeItem('pl-login-timestamp');
        const { error } = await supabase.auth.signOut();
        return { error };
      };

      const isAdmin = user ? ADMIN_EMAILS.includes(user.email?.toLowerCase()) : false;

      return (
        <AuthContext.Provider value={{ user, loading, sendOTP, verifyOTP, inviteUser, signOut, isAdmin }}>
          {children}
        </AuthContext.Provider>
      );
    }

    // Data
    const LONG_FORM_STAGES = [
      { id: 'idea', label: 'Idea', color: '#8b5cf6' },
      { id: 'scheduled-shoot', label: 'Shoot Scheduled', color: '#3b82f6' },
      { id: 'production', label: 'In Production', color: '#f59e0b' },
      { id: 'editing', label: 'Editing', color: '#ec4899' },
      { id: 'review', label: 'Review', color: '#06b6d4' },
      { id: 'scheduled-release', label: 'Scheduled', color: '#10b981' },
      { id: 'published', label: 'Published', color: '#D4FF00' },
    ];

    const SHORT_FORM_STAGES = [
      { id: 'idea', label: 'Idea', color: '#8b5cf6' },
      { id: 'shoot', label: 'Shoot', color: '#3b82f6' },
      { id: 'edit', label: 'Edit', color: '#ec4899' },
      { id: 'scheduled', label: 'Scheduled', color: '#10b981' },
      { id: 'published', label: 'Published', color: '#D4FF00' },
    ];

    const CONTENT_TAGS = [
      // Tour Events
      'Tour Event 1 - Whirlwind',
      'Tour Event 2 - Tahoe',
      'Tour Event 3 - French Lick',
      'Tour Event 4 - Lake of Isles',
      // Teams
      'Team Luke',
      'Team Canada',
      'Team Birdie Fever',
      'Team Top Dawgs',
      'Team King & Queens',
      'Team Twisted',
      'Team Cruz',
      'Team PB&J',
      'Team Stix',
      // Sponsors
      'DraftKings',
      'The Grint',
      // Other
      'ETC',
    ];

    const initialData = {
      content: [
        { id: '1', title: 'Season 3 Kickoff Tournament', description: 'Full tournament coverage with all matches and post-round interviews', type: 'long-form', stage: 'editing', shootDate: '2025-01-10', releaseDate: '2025-01-17', assignee: 'Clay', tags: ['tournament', 'highlights'], notes: 'Need drone footage from hole 7' },
        { id: '2', title: 'Pro Tips: Reading Greens', description: 'Quick tutorial on reading breaks and grain', type: 'short-form', stage: 'scheduled', shootDate: '2025-01-08', releaseDate: '2025-01-14', assignee: 'Clay', tags: ['tutorial'], notes: '' },
        { id: '3', title: 'Match Day 4 Hype', description: 'Quick matchup preview for upcoming competition', type: 'short-form', stage: 'edit', shootDate: '2025-01-12', releaseDate: '2025-01-15', assignee: '', tags: ['promo'], notes: '' },
        { id: '4', title: 'Player Profile: Guest Pro', description: 'Interview and behind-the-scenes with special guest', type: 'long-form', stage: 'scheduled-shoot', shootDate: '2025-01-20', releaseDate: '2025-01-28', assignee: 'Clay', tags: ['interview', 'behind-scenes'], notes: 'Confirm location by Jan 15' },
      ],
      ideas: [
        { id: 'idea-1', title: "Player mic'd up series", description: 'Hot mic moments from tournament play', type: 'short-form', tags: ['behind-scenes'] },
        { id: 'idea-2', title: 'Course flyover series', description: 'Drone footage of each hole with strategy breakdown', type: 'long-form', tags: ['tutorial'] },
        { id: 'idea-3', title: 'Shot of the week', description: 'Weekly compilation of best shots', type: 'short-form', tags: ['highlights'] },
      ],
      team: ['Clay'],
    };

    // Hooks
    function useLocalStorage(key, initialValue) {
      const [storedValue, setStoredValue] = useState(() => {
        try {
          const item = window.localStorage.getItem(key);
          return item ? JSON.parse(item) : initialValue;
        } catch (error) {
          return initialValue;
        }
      });

      useEffect(() => {
        try {
          window.localStorage.setItem(key, JSON.stringify(storedValue));
        } catch (error) {
          console.warn('Error saving to localStorage:', error);
        }
      }, [key, storedValue]);

      return [storedValue, setStoredValue];
    }

    function useContentStore() {
      const { user } = useAuth();
      const [data, setData] = useLocalStorage('pl-content-calendar', initialData);

      const addContent = (content) => {
        const newContent = {
          ...content,
          id: crypto.randomUUID(),
          createdBy: user?.email || 'Unknown',
          createdAt: new Date().toISOString(),
          updatedBy: user?.email || 'Unknown',
          updatedAt: new Date().toISOString(),
        };
        setData((prev) => ({ ...prev, content: [...prev.content, newContent] }));
        return newContent;
      };

      const updateContent = (id, updates) => {
        setData((prev) => ({
          ...prev,
          content: prev.content.map((item) => item.id === id ? {
            ...item,
            ...updates,
            updatedBy: user?.email || 'Unknown',
            updatedAt: new Date().toISOString(),
          } : item),
        }));
      };

      const deleteContent = (id) => {
        setData((prev) => ({ ...prev, content: prev.content.filter((item) => item.id !== id) }));
      };

      const moveContent = (id, newStage) => {
        updateContent(id, { stage: newStage });
      };

      const addIdea = (idea) => {
        const newIdea = {
          ...idea,
          id: crypto.randomUUID(),
          createdBy: user?.email || 'Unknown',
          createdAt: new Date().toISOString(),
        };
        setData((prev) => ({ ...prev, ideas: [...prev.ideas, newIdea] }));
        return newIdea;
      };

      const deleteIdea = (id) => {
        setData((prev) => ({ ...prev, ideas: prev.ideas.filter((item) => item.id !== id) }));
      };

      const promoteIdea = (ideaId) => {
        const idea = data.ideas.find((i) => i.id === ideaId);
        if (!idea) return null;
        const newContent = addContent({
          title: idea.title,
          description: idea.description || '',
          type: idea.type,
          stage: 'idea',
          shootDate: '',
          releaseDate: '',
          assignee: '',
          tags: idea.tags || [],
          notes: '',
        });
        deleteIdea(ideaId);
        return newContent;
      };

      const exportData = () => {
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `pl-calendar-backup-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
      };

      const importData = (jsonData) => {
        try {
          const parsed = JSON.parse(jsonData);
          if (parsed.content && parsed.ideas) {
            setData(parsed);
            return true;
          }
          return false;
        } catch {
          return false;
        }
      };

      return { content: data.content, ideas: data.ideas, team: data.team, addContent, updateContent, deleteContent, moveContent, addIdea, deleteIdea, promoteIdea, exportData, importData };
    }

    // Date utilities
    const formatDate = (date, options = { month: 'short', day: 'numeric' }) => {
      if (typeof date === 'string') date = new Date(date);
      return date.toLocaleDateString('en-US', options);
    };

    const formatMonthYear = (date) => formatDate(date, { month: 'long', year: 'numeric' });
    const formatDayOfWeek = (date) => formatDate(date, { weekday: 'short' });

    const getMonthDays = (date) => {
      const year = date.getFullYear();
      const month = date.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDate = new Date(firstDay);
      startDate.setDate(startDate.getDate() - startDate.getDay());
      const endDate = new Date(lastDay);
      endDate.setDate(endDate.getDate() + (6 - endDate.getDay()));
      const days = [];
      let current = new Date(startDate);
      while (current <= endDate) {
        days.push(new Date(current));
        current.setDate(current.getDate() + 1);
      }
      return days;
    };

    const isToday = (date) => {
      const today = new Date();
      return date.toDateString() === today.toDateString();
    };

    const isSameMonth = (date1, date2) => {
      return date1.getMonth() === date2.getMonth() && date1.getFullYear() === date2.getFullYear();
    };

    // SVG Icons
    const PlusIcon = () => <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M8 3v10M3 8h10" stroke="currentColor" strokeWidth="2" strokeLinecap="round"/></svg>;
    const ChevronLeft = () => <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M10 4L6 8l4 4" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/></svg>;
    const ChevronRight = () => <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M6 4l4 4-4 4" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/></svg>;
    const CloseIcon = () => <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M15 5L5 15M5 5l10 10" stroke="currentColor" strokeWidth="2" strokeLinecap="round"/></svg>;
    const TrashIcon = () => <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M3 4h8M5.5 4V3a1 1 0 011-1h1a1 1 0 011 1v1M6 6.5v3M8 6.5v3M4 4l.5 7a1 1 0 001 1h3a1 1 0 001-1l.5-7" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/></svg>;
    const ArrowUpIcon = () => <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M7 11V3m0 0L4 6m3-3l3 3" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/></svg>;
    const LogoutIcon = () => <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M6 14H3a1 1 0 01-1-1V3a1 1 0 011-1h3M11 11l3-3-3-3M14 8H6" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/></svg>;

    // Peoples League Logo - permanent, from official website
    const PL_LOGO_URL = 'http://peoplesleaguegolf.com/wp-content/uploads/2024/08/PL-_-LIGHT-BACKGROUND-_-LIGHT-BACKGROUND.png';

    const Logo = ({ size = 40, showText = false }) => {
      // For sidebar brand, show full horizontal logo
      if (showText) {
        return (
          <img
            src={PL_LOGO_URL}
            alt="Peoples League"
            style={{ height: size, width: 'auto', objectFit: 'contain' }}
          />
        );
      }
      // For other places, show just a square crop
      return (
        <img
          src={PL_LOGO_URL}
          alt="Peoples League"
          style={{ height: size, width: 'auto', maxWidth: size * 3, objectFit: 'contain' }}
        />
      );
    };

    // User Avatar Component - shows profile pic or initials
    const UserAvatar = ({ email, size = 32, editable = false }) => {
      const { getProfilePic, uploadProfilePic, clearProfilePic } = useProfilePics() || {};
      const profilePic = getProfilePic?.(email);
      const fileInputRef = useRef(null);
      const [showMenu, setShowMenu] = useState(false);

      const initial = email?.charAt(0).toUpperCase() || '?';

      const handleClick = (e) => {
        e.stopPropagation();
        if (editable) {
          setShowMenu(!showMenu);
        }
      };

      const handleUpload = () => {
        fileInputRef.current?.click();
        setShowMenu(false);
      };

      const handleFileChange = async (e) => {
        const file = e.target.files?.[0];
        if (file) {
          if (file.size > 300000) {
            alert('Image too large. Please use an image under 300KB.');
            return;
          }
          try {
            await uploadProfilePic(email, file);
          } catch (err) {
            alert(err.message);
          }
        }
        e.target.value = '';
      };

      const handleClear = () => {
        clearProfilePic?.(email);
        setShowMenu(false);
      };

      return (
        <div className="user-avatar-container" style={{ position: 'relative', display: 'inline-block' }}>
          {profilePic ? (
            <img
              src={profilePic}
              alt={email}
              width={size}
              height={size}
              style={{
                borderRadius: '50%',
                objectFit: 'cover',
                cursor: editable ? 'pointer' : 'default',
              }}
              onClick={handleClick}
              title={email}
            />
          ) : (
            <div
              className="user-avatar"
              style={{
                width: size,
                height: size,
                borderRadius: '50%',
                background: 'var(--pl-lime)',
                color: 'var(--pl-teal)',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                fontWeight: 600,
                fontSize: size * 0.45,
                cursor: editable ? 'pointer' : 'default',
              }}
              onClick={handleClick}
              title={email}
            >
              {initial}
            </div>
          )}
          {editable && showMenu && (
            <div className="avatar-menu">
              <button onClick={handleUpload}>{profilePic ? 'Change Photo' : 'Upload Photo'}</button>
              {profilePic && <button onClick={handleClear}>Remove Photo</button>}
            </div>
          )}
          {editable && (
            <input
              ref={fileInputRef}
              type="file"
              accept="image/*"
              onChange={handleFileChange}
              style={{ display: 'none' }}
            />
          )}
        </div>
      );
    };

    // Admin Portal Component
    const AdminPortal = ({ onClose }) => {
      const { inviteUser } = useAuth();
      const [email, setEmail] = useState('');
      const [loading, setLoading] = useState(false);
      const [message, setMessage] = useState({ type: '', text: '' });
      const [teamMembers, setTeamMembers] = useState(() => {
        try {
          return JSON.parse(localStorage.getItem('pl-team-members') || '[]');
        } catch {
          return [];
        }
      });

      useEffect(() => {
        localStorage.setItem('pl-team-members', JSON.stringify(teamMembers));
      }, [teamMembers]);

      const handleInviteUser = async (e) => {
        e.preventDefault();
        setMessage({ type: '', text: '' });
        setLoading(true);

        const { data, error } = await inviteUser(email);
        if (error) {
          setMessage({ type: 'error', text: error.message });
        } else {
          setMessage({ type: 'success', text: `Invite sent to ${email}! They'll receive a login code via email.` });
          if (!teamMembers.includes(email.toLowerCase())) {
            setTeamMembers(prev => [...prev, email.toLowerCase()]);
          }
          setEmail('');
        }
        setLoading(false);
      };

      const handleRemoveMember = (memberEmail) => {
        if (confirm(`Remove ${memberEmail} from the team list? (Note: This doesn't delete their Supabase account)`)) {
          setTeamMembers(prev => prev.filter(m => m !== memberEmail));
        }
      };

      const handleResendInvite = async (memberEmail) => {
        setMessage({ type: '', text: '' });
        const { data, error } = await inviteUser(memberEmail);
        if (error) {
          setMessage({ type: 'error', text: error.message });
        } else {
          setMessage({ type: 'success', text: `New login code sent to ${memberEmail}!` });
        }
      };

      return (
        <div className="admin-portal">
          <div className="admin-header">
            <h2>Admin Portal</h2>
            <p>Invite team members to access the content calendar</p>
          </div>

          <div className="admin-section">
            <h3>Invite New Team Member</h3>
            <p style={{ fontSize: '13px', color: 'var(--text-secondary)', marginBottom: 'var(--space-md)' }}>
              Enter their email address. They'll receive a login code to access the calendar.
            </p>
            <form onSubmit={handleInviteUser} className="admin-form">
              {message.text && (
                <div className={message.type === 'error' ? 'auth-error' : 'auth-success'}>
                  {message.text}
                </div>
              )}
              <div className="form-group">
                <label className="form-label">Email Address</label>
                <input
                  type="email"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  className="form-input"
                  placeholder="teammate@example.com"
                  required
                />
              </div>
              <Button variant="primary" type="submit" disabled={loading}>
                {loading ? <span className="loading-spinner" /> : 'Send Invite'}
              </Button>
            </form>
          </div>

          <div className="admin-section">
            <h3>Team Members</h3>
            {teamMembers.length === 0 ? (
              <p className="admin-empty">No team members added yet. Invite users above.</p>
            ) : (
              <div className="admin-team-list">
                {teamMembers.map(member => (
                  <div key={member} className="admin-team-member">
                    <UserAvatar email={member} size={32} />
                    <span className="admin-team-email">{member}</span>
                    <Button variant="ghost" size="sm" onClick={() => handleResendInvite(member)} title="Resend login code">
                      <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                        <path d="M1 7a6 6 0 1011.5 2.5M12.5 9.5v-3h-3" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
                      </svg>
                    </Button>
                    <Button variant="ghost" size="sm" onClick={() => handleRemoveMember(member)} title="Remove from list">
                      <TrashIcon />
                    </Button>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>
      );
    };

    // Help Guide Component
    const HelpGuide = ({ onClose }) => {
      const [activeSection, setActiveSection] = useState('overview');

      const sections = [
        { id: 'overview', label: 'Overview' },
        { id: 'pipeline', label: 'Pipeline View' },
        { id: 'calendar', label: 'Calendar View' },
        { id: 'ideas', label: 'Ideas Bank' },
        { id: 'roles', label: 'By Role' },
        { id: 'tips', label: 'Quick Tips' },
      ];

      return (
        <div className="help-guide">
          <div className="help-header">
            <div>
              <h2>How to Use the Content Calendar</h2>
              <p>Everything you need to know to manage content effectively</p>
            </div>
            <Button variant="ghost" size="sm" onClick={onClose}><CloseIcon /></Button>
          </div>

          <div className="help-nav">
            {sections.map(section => (
              <button
                key={section.id}
                className={`help-nav-btn ${activeSection === section.id ? 'active' : ''}`}
                onClick={() => setActiveSection(section.id)}
              >
                {section.label}
              </button>
            ))}
          </div>

          <div className="help-content">
            {activeSection === 'overview' && (
              <div className="help-section">
                <h3>Welcome to the Peoples League Content Calendar</h3>
                <p>This platform helps our team coordinate content production across long-form and short-form content. Here's the big picture:</p>

                <div className="help-card">
                  <h4>Three Main Views</h4>
                  <ul>
                    <li><strong>Pipeline</strong>  See all content moving through production stages (like a Kanban board)</li>
                    <li><strong>Calendar</strong>  See shoot dates and release dates on a monthly calendar</li>
                    <li><strong>Ideas</strong>  Capture and store content ideas before they enter production</li>
                  </ul>
                </div>

                <div className="help-card">
                  <h4>Two Content Types</h4>
                  <ul>
                    <li><strong style={{color: 'var(--type-long)'}}>Long-form</strong>  Full videos (tournaments, interviews, etc.) with 7 production stages</li>
                    <li><strong style={{color: 'var(--type-short)'}}>Short-form</strong>  Quick clips, reels, shorts with 5 production stages</li>
                  </ul>
                </div>

                <div className="help-card">
                  <h4>Notification Badges</h4>
                  <p>The numbers next to Pipeline and Ideas show <strong>new items you haven't seen yet</strong>. Once you view that section, they're marked as read. This helps you quickly spot what's changed since your last visit.</p>
                </div>
              </div>
            )}

            {activeSection === 'pipeline' && (
              <div className="help-section">
                <h3>Pipeline View</h3>
                <p>The Pipeline is your production command center. Content moves left-to-right through stages.</p>

                <div className="help-card">
                  <h4>Long-form Stages</h4>
                  <ol className="help-stages">
                    <li><span className="help-stage-dot" style={{background: '#8b5cf6'}}/>Idea  Initial concept</li>
                    <li><span className="help-stage-dot" style={{background: '#3b82f6'}}/>Shoot Scheduled  Date locked in</li>
                    <li><span className="help-stage-dot" style={{background: '#f59e0b'}}/>In Production  Currently filming</li>
                    <li><span className="help-stage-dot" style={{background: '#ec4899'}}/>Editing  Post-production</li>
                    <li><span className="help-stage-dot" style={{background: '#06b6d4'}}/>Review  Final review before publish</li>
                    <li><span className="help-stage-dot" style={{background: '#10b981'}}/>Scheduled  Ready, waiting for release date</li>
                    <li><span className="help-stage-dot" style={{background: '#D4FF00'}}/>Published  Live!</li>
                  </ol>
                </div>

                <div className="help-card">
                  <h4>Short-form Stages</h4>
                  <ol className="help-stages">
                    <li><span className="help-stage-dot" style={{background: '#8b5cf6'}}/>Idea  Initial concept</li>
                    <li><span className="help-stage-dot" style={{background: '#3b82f6'}}/>Shoot  Filming</li>
                    <li><span className="help-stage-dot" style={{background: '#ec4899'}}/>Edit  Post-production</li>
                    <li><span className="help-stage-dot" style={{background: '#10b981'}}/>Scheduled  Ready for release</li>
                    <li><span className="help-stage-dot" style={{background: '#D4FF00'}}/>Published  Live!</li>
                  </ol>
                </div>

                <div className="help-card">
                  <h4>How to Use</h4>
                  <ul>
                    <li><strong>Add content:</strong> Click the green "+ Add Content" button</li>
                    <li><strong>Move content:</strong> Drag cards between columns, or use the arrow buttons</li>
                    <li><strong>Edit content:</strong> Click any card to open details</li>
                    <li><strong>Filter:</strong> Use "All Content", "Long-form", or "Short-form" tabs to filter</li>
                  </ul>
                </div>
              </div>
            )}

            {activeSection === 'calendar' && (
              <div className="help-section">
                <h3>Calendar View</h3>
                <p>See your content schedule at a glance with shoot and release dates.</p>

                <div className="help-card">
                  <h4>Understanding the Calendar</h4>
                  <ul>
                    <li><span className="help-dot" style={{background: 'var(--type-long)'}}/>Blue dot = Shoot day scheduled</li>
                    <li><span className="help-dot" style={{background: 'var(--pl-lime)'}}/>Green dot = Release day scheduled</li>
                    <li><strong>S:</strong> prefix = Shoot event</li>
                    <li><strong>R:</strong> prefix = Release event</li>
                  </ul>
                </div>

                <div className="help-card">
                  <h4>How to Use</h4>
                  <ul>
                    <li><strong>Navigate:</strong> Use arrows to move between months</li>
                    <li><strong>Today:</strong> Click "Today" to jump back to current month</li>
                    <li><strong>View details:</strong> Click any event to see full content details</li>
                    <li><strong>Add content:</strong> Click "+ Add Content" to create new</li>
                  </ul>
                </div>
              </div>
            )}

            {activeSection === 'ideas' && (
              <div className="help-section">
                <h3>Ideas Bank</h3>
                <p>Capture ideas before they're ready for production. Think of this as your content brainstorm storage.</p>

                <div className="help-card">
                  <h4>How Ideas Work</h4>
                  <ul>
                    <li><strong>Add ideas quickly:</strong> Just a title is enough  description and tags are optional</li>
                    <li><strong>Categorize:</strong> Mark as Long-form or Short-form</li>
                    <li><strong>Tag:</strong> Add tags like "tutorial", "behind-scenes", etc.</li>
                    <li><strong>Start production:</strong> Click "Start" to move an idea into the Pipeline</li>
                    <li><strong>Delete:</strong> Remove ideas that won't happen</li>
                  </ul>
                </div>

                <div className="help-card">
                  <h4>Best Practices</h4>
                  <ul>
                    <li>Capture ideas immediately  don't let them slip away</li>
                    <li>Review the Ideas Bank in team meetings for planning</li>
                    <li>Only "Start" an idea when you're ready to commit to production</li>
                  </ul>
                </div>
              </div>
            )}

            {activeSection === 'roles' && (
              <div className="help-section">
                <h3>Guide by Role</h3>

                <div className="help-card help-role">
                  <h4> Head of Production</h4>
                  <p>Your main focus: Pipeline view</p>
                  <ul>
                    <li>Use Pipeline to track what's filming, editing, and in review</li>
                    <li>Move cards as production progresses</li>
                    <li>Add shoot dates when scheduling</li>
                    <li>Use the "assignee" field to track who's responsible</li>
                    <li>Check Calendar view to avoid scheduling conflicts</li>
                  </ul>
                </div>

                <div className="help-card help-role">
                  <h4> Head of Social</h4>
                  <p>Your main focus: Calendar + Short-form content</p>
                  <ul>
                    <li>Use Calendar to see what's releasing when</li>
                    <li>Filter Pipeline by "Short-form" to focus on social content</li>
                    <li>Add release dates for content going live</li>
                    <li>Use Ideas Bank to capture quick content opportunities</li>
                    <li>Check "Scheduled" column for what's ready to post</li>
                  </ul>
                </div>

                <div className="help-card help-role">
                  <h4> Head of Sales</h4>
                  <p>Your main focus: Calendar + Understanding what's coming</p>
                  <ul>
                    <li>Use Calendar for an overview of upcoming content</li>
                    <li>Check Pipeline's "Scheduled" column to see what's releasing soon</li>
                    <li>Look at "Published" to reference recent content</li>
                    <li>Use this visibility for sales conversations and partnerships</li>
                  </ul>
                </div>

                <div className="help-card help-role">
                  <h4> CEO</h4>
                  <p>Your main focus: High-level overview</p>
                  <ul>
                    <li>Pipeline gives you a snapshot of all active production</li>
                    <li>Calendar shows the content schedule at a glance</li>
                    <li>Notification badges show you what's new since you last checked</li>
                    <li>Click into any content card to see details and notes</li>
                    <li>Ideas Bank shows what's in the brainstorm pipeline</li>
                  </ul>
                </div>
              </div>
            )}

            {activeSection === 'tips' && (
              <div className="help-section">
                <h3>Quick Tips</h3>

                <div className="help-card">
                  <h4>Keyboard & Navigation</h4>
                  <ul>
                    <li>Press <strong>Escape</strong> to close any popup/modal</li>
                    <li>Click outside a modal to close it</li>
                    <li>Drag and drop cards between Pipeline columns</li>
                  </ul>
                </div>

                <div className="help-card">
                  <h4>Staying Organized</h4>
                  <ul>
                    <li>Use <strong>tags</strong> to categorize content (tournament, tutorial, etc.)</li>
                    <li>Always set <strong>release dates</strong> so content appears on the calendar</li>
                    <li>Add <strong>notes</strong> for context that others need to know</li>
                    <li>Assign content to team members for accountability</li>
                  </ul>
                </div>

                <div className="help-card">
                  <h4>Data & Backup</h4>
                  <ul>
                    <li><strong>Export:</strong> Click "Export" to download a backup of all data</li>
                    <li><strong>Import:</strong> Click "Import" to restore from a backup file</li>
                    <li>Data is saved automatically as you work</li>
                  </ul>
                </div>

                <div className="help-card">
                  <h4>Profile</h4>
                  <ul>
                    <li>Click your avatar in the sidebar to upload a profile picture</li>
                    <li>Your edits are tracked  others can see who last modified content</li>
                    <li>You stay logged in for 7 days automatically</li>
                  </ul>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    };

    // Auth Page Component - OTP (email code) login
    const AuthPage = () => {
      const { sendOTP, verifyOTP } = useAuth();
      const [step, setStep] = useState('email'); // 'email' or 'code'
      const [email, setEmail] = useState('');
      const [code, setCode] = useState('');
      const [error, setError] = useState('');
      const [loading, setLoading] = useState(false);

      const handleSendCode = async (e) => {
        e.preventDefault();
        setError('');
        setLoading(true);

        const { data, error } = await sendOTP(email);
        if (error) {
          if (error.message.includes('Signups not allowed')) {
            setError('This email is not registered. Please contact an admin to get access.');
          } else {
            setError(error.message);
          }
        } else {
          setStep('code');
        }
        setLoading(false);
      };

      const handleVerifyCode = async (e) => {
        e.preventDefault();
        setError('');
        setLoading(true);

        const { data, error } = await verifyOTP(email, code);
        if (error) {
          setError('Invalid or expired code. Please try again.');
        }
        setLoading(false);
      };

      const handleBack = () => {
        setStep('email');
        setCode('');
        setError('');
      };

      return (
        <div className="auth-page">
          <div className="auth-container">
            <div className="auth-header">
              <Logo size={60} />
              <h1>Peoples League</h1>
              <p>Content Calendar</p>
            </div>

            {step === 'email' ? (
              <>
                <h2 style={{ fontSize: '16px', fontWeight: '600', marginBottom: 'var(--space-md)', color: 'var(--text-primary)' }}>Sign In</h2>
                <p style={{ fontSize: '13px', color: 'var(--text-secondary)', marginBottom: 'var(--space-md)' }}>
                  Enter your email and we'll send you a login code.
                </p>
                {error && <div className="auth-error">{error}</div>}
                <form className="auth-form" onSubmit={handleSendCode}>
                  <div className="form-group">
                    <label className="form-label">Email</label>
                    <input
                      type="email"
                      value={email}
                      onChange={(e) => setEmail(e.target.value)}
                      className="form-input"
                      placeholder="you@example.com"
                      required
                      autoFocus
                    />
                  </div>
                  <Button variant="primary" type="submit" disabled={loading}>
                    {loading ? <span className="loading-spinner" /> : 'Send Code'}
                  </Button>
                </form>
              </>
            ) : (
              <>
                <h2 style={{ fontSize: '16px', fontWeight: '600', marginBottom: 'var(--space-md)', color: 'var(--text-primary)' }}>Enter Code</h2>
                <p style={{ fontSize: '13px', color: 'var(--text-secondary)', marginBottom: 'var(--space-md)' }}>
                  We sent a code to <strong style={{ color: 'var(--text-primary)' }}>{email}</strong>
                </p>
                {error && <div className="auth-error">{error}</div>}
                <form className="auth-form" onSubmit={handleVerifyCode}>
                  <div className="form-group">
                    <label className="form-label">Login Code</label>
                    <input
                      type="text"
                      value={code}
                      onChange={(e) => setCode(e.target.value.replace(/\D/g, '').slice(0, 8))}
                      className="form-input"
                      placeholder="00000000"
                      required
                      autoFocus
                      style={{ letterSpacing: '0.3em', textAlign: 'center', fontSize: '20px' }}
                      maxLength={8}
                    />
                  </div>
                  <Button variant="primary" type="submit" disabled={loading || code.length !== 8}>
                    {loading ? <span className="loading-spinner" /> : 'Verify & Sign In'}
                  </Button>
                  <div style={{ textAlign: 'center', marginTop: 'var(--space-md)' }}>
                    <button
                      type="button"
                      onClick={handleBack}
                      style={{ color: 'var(--text-secondary)', fontSize: '13px', textDecoration: 'underline' }}
                    >
                      Use a different email
                    </button>
                  </div>
                </form>
              </>
            )}
          </div>
        </div>
      );
    };

    // Components
    const Button = ({ children, variant = 'default', size = 'md', onClick, type = 'button', disabled = false }) => (
      <button type={type} onClick={onClick} disabled={disabled} className={`btn btn-${variant} btn-${size}`}>
        {children}
      </button>
    );

    const Badge = ({ children, variant = 'default' }) => (
      <span className={`badge badge-${variant}`}>{children}</span>
    );

    const Modal = ({ isOpen, onClose, title, children }) => {
      const modalRef = useRef(null);

      useEffect(() => {
        const handleEscape = (e) => { if (e.key === 'Escape') onClose(); };
        if (isOpen) {
          document.addEventListener('keydown', handleEscape);
          document.body.style.overflow = 'hidden';
        }
        return () => {
          document.removeEventListener('keydown', handleEscape);
          document.body.style.overflow = '';
        };
      }, [isOpen, onClose]);

      const handleBackdropClick = (e) => { if (e.target === modalRef.current) onClose(); };

      if (!isOpen) return null;

      return (
        <div className="modal-backdrop" ref={modalRef} onClick={handleBackdropClick}>
          <div className="modal">
            <div className="modal-header">
              <h2 className="modal-title">{title}</h2>
              <Button variant="ghost" size="sm" onClick={onClose}><CloseIcon /></Button>
            </div>
            <div className="modal-body">{children}</div>
          </div>
        </div>
      );
    };

    const ContentCard = ({ content, onClick, compact = false, draggable = false, onDragStart, onDragEnd }) => {
      const stages = content.type === 'long-form' ? LONG_FORM_STAGES : SHORT_FORM_STAGES;
      const currentStage = stages.find((s) => s.id === content.stage);
      const [isDragging, setIsDragging] = useState(false);

      const handleDragStart = (e) => {
        setIsDragging(true);
        e.dataTransfer.setData('text/plain', content.id);
        e.dataTransfer.effectAllowed = 'move';
        if (onDragStart) onDragStart(content);
      };

      const handleDragEnd = (e) => {
        setIsDragging(false);
        if (onDragEnd) onDragEnd();
      };

      return (
        <div
          className={`content-card ${compact ? 'content-card-compact' : ''} ${isDragging ? 'dragging' : ''}`}
          onClick={onClick}
          draggable={draggable}
          onDragStart={handleDragStart}
          onDragEnd={handleDragEnd}
        >
          <div className="content-card-header">
            <Badge variant={content.type === 'long-form' ? 'type-long' : 'type-short'}>
              {content.type === 'long-form' ? 'Long' : 'Short'}
            </Badge>
            {content.assignee && <span className="content-card-assignee">{content.assignee}</span>}
          </div>
          <h4 className="content-card-title">{content.title}</h4>
          {!compact && content.description && <p className="content-card-desc">{content.description}</p>}
          <div className="content-card-footer">
            <div className="content-card-dates">
              {content.shootDate && <div className="content-card-date">Shoot: {formatDate(content.shootDate)}</div>}
              {content.releaseDate && <div className="content-card-date release">Release: {formatDate(content.releaseDate)}</div>}
            </div>
            {content.tags?.length > 0 && !compact && (
              <div className="content-card-tags">
                {content.tags.slice(0, 2).map((tag) => <span key={tag} className="content-card-tag">{tag}</span>)}
                {content.tags.length > 2 && <span className="content-card-tag">+{content.tags.length - 2}</span>}
              </div>
            )}
          </div>
          {content.updatedBy && (
            <div className="content-card-meta">
              <UserAvatar email={content.updatedBy} size={16} />
              <span>Edited by {content.updatedBy.split('@')[0]}</span>
            </div>
          )}
          <div className="content-card-stage-indicator" style={{ background: currentStage?.color }} />
        </div>
      );
    };

    const ContentForm = ({ content, team, onSave, onDelete, onClose }) => {
      const { user } = useAuth();
      const [formData, setFormData] = useState({
        title: content?.title || '',
        description: content?.description || '',
        type: content?.type || 'short-form',
        stage: content?.stage || 'idea',
        shootDate: content?.shootDate || '',
        releaseDate: content?.releaseDate || '',
        assignee: content?.assignee || '',
        tags: content?.tags || [],
        notes: content?.notes || '',
      });

      // Get team members from localStorage (added via Admin Portal)
      const teamMembers = React.useMemo(() => {
        try {
          const stored = JSON.parse(localStorage.getItem('pl-team-members') || '[]');
          // Also include the current user if not in the list
          if (user?.email && !stored.includes(user.email.toLowerCase())) {
            return [user.email.toLowerCase(), ...stored];
          }
          return stored;
        } catch {
          return user?.email ? [user.email.toLowerCase()] : [];
        }
      }, [user?.email]);

      const isEditing = !!content?.id;
      const stages = formData.type === 'long-form' ? LONG_FORM_STAGES : SHORT_FORM_STAGES;
      const creator = content?.createdBy || null;

      const handleChange = (e) => {
        const { name, value } = e.target;
        setFormData((prev) => ({ ...prev, [name]: value }));
      };

      const handleTypeChange = (type) => {
        setFormData((prev) => ({ ...prev, type, stage: 'idea' }));
      };

      const handleTagToggle = (tag) => {
        setFormData((prev) => ({
          ...prev,
          tags: prev.tags.includes(tag) ? prev.tags.filter((t) => t !== tag) : [...prev.tags, tag],
        }));
      };

      const handleSubmit = (e) => {
        e.preventDefault();
        if (!formData.title.trim()) return;
        onSave(formData);
      };

      return (
        <form className="content-form" onSubmit={handleSubmit}>
          <div className="form-group">
            <label className="form-label">Title</label>
            <input type="text" name="title" value={formData.title} onChange={handleChange} className="form-input" placeholder="Enter content title..." autoFocus />
          </div>
          <div className="form-group">
            <label className="form-label">Description</label>
            <textarea name="description" value={formData.description} onChange={handleChange} className="form-textarea" placeholder="Brief description..." rows={2} />
          </div>
          <div className="form-row">
            <div className="form-group">
              <label className="form-label">Content Type</label>
              <div className="form-type-toggle">
                <button type="button" className={`form-type-btn ${formData.type === 'long-form' ? 'active long' : ''}`} onClick={() => handleTypeChange('long-form')}>Long-form</button>
                <button type="button" className={`form-type-btn ${formData.type === 'short-form' ? 'active short' : ''}`} onClick={() => handleTypeChange('short-form')}>Short-form</button>
              </div>
            </div>
            <div className="form-group">
              <label className="form-label">Stage</label>
              <select name="stage" value={formData.stage} onChange={handleChange} className="form-select">
                {stages.map((stage) => <option key={stage.id} value={stage.id}>{stage.label}</option>)}
              </select>
            </div>
          </div>
          <div className="form-row">
            <div className="form-group">
              <label className="form-label">Shoot Date</label>
              <input type="date" name="shootDate" value={formData.shootDate} onChange={handleChange} className="form-input" />
            </div>
            <div className="form-group">
              <label className="form-label">Release Date</label>
              <input type="date" name="releaseDate" value={formData.releaseDate} onChange={handleChange} className="form-input" />
            </div>
          </div>
          <div className="form-row">
            {isEditing && creator && (
              <div className="form-group">
                <label className="form-label">Creator</label>
                <input type="text" value={creator} className="form-input" disabled style={{ opacity: 0.7, cursor: 'not-allowed' }} />
              </div>
            )}
            <div className="form-group">
              <label className="form-label">Assignee</label>
              <select name="assignee" value={formData.assignee} onChange={handleChange} className="form-select">
                <option value="">Unassigned</option>
                {teamMembers.map((member) => <option key={member} value={member}>{member}</option>)}
              </select>
            </div>
          </div>
          <div className="form-group">
            <label className="form-label">Tags</label>
            <div className="form-tags">
              {CONTENT_TAGS.map((tag) => (
                <button key={tag} type="button" className={`form-tag ${formData.tags.includes(tag) ? 'active' : ''}`} onClick={() => handleTagToggle(tag)}>{tag}</button>
              ))}
            </div>
          </div>
          <div className="form-group">
            <label className="form-label">Notes</label>
            <textarea name="notes" value={formData.notes} onChange={handleChange} className="form-textarea" placeholder="Additional notes..." rows={3} />
          </div>
          <div className="form-actions">
            {isEditing && <Button type="button" variant="danger" onClick={() => onDelete(content.id)}>Delete</Button>}
            <div className="form-actions-right">
              <Button type="button" variant="ghost" onClick={onClose}>Cancel</Button>
              <Button type="submit" variant="primary">{isEditing ? 'Save Changes' : 'Create Content'}</Button>
            </div>
          </div>
        </form>
      );
    };

    const PipelineColumn = ({ stage, items, onCardClick, onMoveContent, allStages, onDragOver, onDrop, isDragOver, draggedItem }) => {
      const handleMoveClick = (e, item, direction) => {
        e.stopPropagation();
        const currentIndex = allStages.findIndex((s) => s.id === item.stage);
        const newIndex = direction === 'forward' ? currentIndex + 1 : currentIndex - 1;
        if (newIndex >= 0 && newIndex < allStages.length) {
          onMoveContent(item.id, allStages[newIndex].id);
        }
      };

      const handleDragOver = (e) => {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
        if (onDragOver) onDragOver(stage.id);
      };

      const handleDragLeave = (e) => {
        if (e.currentTarget.contains(e.relatedTarget)) return;
        if (onDragOver) onDragOver(null);
      };

      const handleDrop = (e) => {
        e.preventDefault();
        const contentId = e.dataTransfer.getData('text/plain');
        if (contentId && onDrop) {
          onDrop(contentId, stage.id);
        }
      };

      const canAcceptDrag = draggedItem ? allStages.some(s => s.id === stage.id) : true;

      return (
        <div
          className={`pipeline-column ${isDragOver && canAcceptDrag ? 'drag-over' : ''}`}
          onDragOver={canAcceptDrag ? handleDragOver : undefined}
          onDragLeave={handleDragLeave}
          onDrop={canAcceptDrag ? handleDrop : undefined}
        >
          <div className="pipeline-column-header">
            <div className="pipeline-column-dot" style={{ background: stage.color }} />
            <h3 className="pipeline-column-title">{stage.label}</h3>
            <span className="pipeline-column-count">{items.length}</span>
          </div>
          <div className="pipeline-column-content">
            {isDragOver && canAcceptDrag && <div className="drag-placeholder" />}
            {items.map((item) => {
              const currentIndex = allStages.findIndex((s) => s.id === item.stage);
              const canMoveBack = currentIndex > 0;
              const canMoveForward = currentIndex < allStages.length - 1;
              return (
                <div key={item.id} className="pipeline-card-wrapper">
                  <ContentCard content={item} onClick={() => onCardClick(item)} draggable={true} />
                  <div className="pipeline-card-actions">
                    {canMoveBack && <button className="pipeline-move-btn" onClick={(e) => handleMoveClick(e, item, 'back')} title={`Move to ${allStages[currentIndex - 1].label}`}><ChevronLeft /></button>}
                    {canMoveForward && <button className="pipeline-move-btn forward" onClick={(e) => handleMoveClick(e, item, 'forward')} title={`Move to ${allStages[currentIndex + 1].label}`}><ChevronRight /></button>}
                  </div>
                </div>
              );
            })}
            {items.length === 0 && !isDragOver && <div className="pipeline-empty">No content</div>}
          </div>
        </div>
      );
    };

    const PipelineBoard = ({ content, onCardClick, onMoveContent, onAddClick }) => {
      const [activeType, setActiveType] = useState('all');
      const [dragOverStage, setDragOverStage] = useState(null);
      const [draggedItem, setDraggedItem] = useState(null);
      const stages = activeType === 'long-form' ? LONG_FORM_STAGES : activeType === 'short-form' ? SHORT_FORM_STAGES : LONG_FORM_STAGES;

      const getItemsForStage = (stageId) => {
        if (activeType === 'all') {
          return content.filter((item) => {
            const itemStages = item.type === 'long-form' ? LONG_FORM_STAGES : SHORT_FORM_STAGES;
            return itemStages.some((s) => s.id === stageId) && item.stage === stageId;
          });
        }
        return content.filter((item) => item.type === activeType && item.stage === stageId);
      };

      const handleDragOver = (stageId) => {
        setDragOverStage(stageId);
      };

      const handleDrop = (contentId, newStageId) => {
        const item = content.find(c => c.id === contentId);
        if (item) {
          const itemStages = item.type === 'long-form' ? LONG_FORM_STAGES : SHORT_FORM_STAGES;
          if (itemStages.some(s => s.id === newStageId)) {
            onMoveContent(contentId, newStageId);
          }
        }
        setDragOverStage(null);
        setDraggedItem(null);
      };

      const handleDragStart = (item) => {
        setDraggedItem(item);
      };

      const handleDragEnd = () => {
        setDragOverStage(null);
        setDraggedItem(null);
      };

      return (
        <div className="pipeline-board" onDragEnd={handleDragEnd}>
          <div className="pipeline-header">
            <div className="pipeline-filters">
              <button className={`pipeline-filter ${activeType === 'all' ? 'active' : ''}`} onClick={() => setActiveType('all')}>All Content</button>
              <button className={`pipeline-filter long ${activeType === 'long-form' ? 'active' : ''}`} onClick={() => setActiveType('long-form')}>Long-form</button>
              <button className={`pipeline-filter short ${activeType === 'short-form' ? 'active' : ''}`} onClick={() => setActiveType('short-form')}>Short-form</button>
            </div>
            <Button variant="primary" onClick={onAddClick}><PlusIcon /> Add Content</Button>
          </div>
          <div className="pipeline-columns">
            {stages.map((stage) => (
              <PipelineColumn
                key={stage.id}
                stage={stage}
                items={getItemsForStage(stage.id)}
                onCardClick={onCardClick}
                onMoveContent={onMoveContent}
                allStages={stages}
                onDragOver={handleDragOver}
                onDrop={handleDrop}
                isDragOver={dragOverStage === stage.id}
                draggedItem={draggedItem}
              />
            ))}
          </div>
        </div>
      );
    };

    const CalendarDay = ({ date, currentMonth, items, onCardClick }) => {
      const today = isToday(date);
      const inMonth = isSameMonth(date, currentMonth);
      const dateStr = date.toISOString().split('T')[0];
      const shootItems = items.filter((item) => item.shootDate === dateStr);
      const releaseItems = items.filter((item) => item.releaseDate === dateStr);

      return (
        <div className={`calendar-day ${!inMonth ? 'outside' : ''} ${today ? 'today' : ''}`}>
          <div className="calendar-day-header">
            <span className="calendar-day-number">{date.getDate()}</span>
            {(shootItems.length > 0 || releaseItems.length > 0) && (
              <div className="calendar-day-dots">
                {shootItems.length > 0 && <span className="calendar-dot shoot" />}
                {releaseItems.length > 0 && <span className="calendar-dot release" />}
              </div>
            )}
          </div>
          <div className="calendar-day-content">
            {shootItems.map((item) => (
              <div key={`shoot-${item.id}`} className="calendar-event shoot" onClick={() => onCardClick(item)}>
                <span className="calendar-event-label">S:</span>
                <span className="calendar-event-title">{item.title}</span>
              </div>
            ))}
            {releaseItems.map((item) => (
              <div key={`release-${item.id}`} className="calendar-event release" onClick={() => onCardClick(item)}>
                <span className="calendar-event-label">R:</span>
                <span className="calendar-event-title">{item.title}</span>
              </div>
            ))}
          </div>
        </div>
      );
    };

    const MonthView = ({ content, onCardClick, onAddClick }) => {
      const [currentDate, setCurrentDate] = useState(new Date());
      const days = getMonthDays(currentDate);

      const goToPrevMonth = () => setCurrentDate((d) => new Date(d.getFullYear(), d.getMonth() - 1, 1));
      const goToNextMonth = () => setCurrentDate((d) => new Date(d.getFullYear(), d.getMonth() + 1, 1));
      const goToToday = () => setCurrentDate(new Date());

      return (
        <div className="month-view">
          <div className="month-header">
            <div className="month-nav">
              <Button variant="ghost" size="sm" onClick={goToPrevMonth}><ChevronLeft /></Button>
              <h2 className="month-title">{formatMonthYear(currentDate)}</h2>
              <Button variant="ghost" size="sm" onClick={goToNextMonth}><ChevronRight /></Button>
            </div>
            <div className="month-actions">
              <Button variant="ghost" size="sm" onClick={goToToday}>Today</Button>
              <Button variant="primary" onClick={onAddClick}><PlusIcon /> Add Content</Button>
            </div>
          </div>
          <div className="month-legend">
            <div className="month-legend-item"><span className="month-legend-dot shoot" /><span>Shoot Day</span></div>
            <div className="month-legend-item"><span className="month-legend-dot release" /><span>Release Day</span></div>
          </div>
          <div className="month-grid">
            {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map((day) => <div key={day} className="month-weekday">{day}</div>)}
            {days.map((day) => <CalendarDay key={day.toISOString()} date={day} currentMonth={currentDate} items={content} onCardClick={onCardClick} />)}
          </div>
        </div>
      );
    };

    const IdeaCard = ({ idea, onPromote, onDelete }) => (
      <div className="idea-card">
        <div className="idea-card-header">
          <Badge variant={idea.type === 'long-form' ? 'type-long' : 'type-short'}>{idea.type === 'long-form' ? 'Long' : 'Short'}</Badge>
        </div>
        <h4 className="idea-card-title">{idea.title}</h4>
        {idea.description && <p className="idea-card-desc">{idea.description}</p>}
        {idea.tags?.length > 0 && (
          <div className="idea-card-tags">
            {idea.tags.map((tag) => <span key={tag} className="idea-card-tag">{tag}</span>)}
          </div>
        )}
        <div className="idea-card-actions">
          <Button variant="ghost" size="sm" onClick={() => onDelete(idea.id)}><TrashIcon /></Button>
          <Button variant="primary" size="sm" onClick={() => onPromote(idea.id)}><ArrowUpIcon /> Start</Button>
        </div>
      </div>
    );

    const IdeasBank = ({ ideas, onAddIdea, onPromote, onDelete }) => {
      const [isAdding, setIsAdding] = useState(false);
      const [newIdea, setNewIdea] = useState({ title: '', description: '', type: 'short-form', tags: [] });

      const handleSubmit = (e) => {
        e.preventDefault();
        if (!newIdea.title.trim()) return;
        onAddIdea(newIdea);
        setNewIdea({ title: '', description: '', type: 'short-form', tags: [] });
        setIsAdding(false);
      };

      const handleTagToggle = (tag) => {
        setNewIdea((prev) => ({
          ...prev,
          tags: prev.tags.includes(tag) ? prev.tags.filter((t) => t !== tag) : [...prev.tags, tag],
        }));
      };

      const longFormIdeas = ideas.filter((i) => i.type === 'long-form');
      const shortFormIdeas = ideas.filter((i) => i.type === 'short-form');

      return (
        <div className="ideas-bank">
          <div className="ideas-header">
            <div>
              <h2 className="ideas-title">Ideas Bank</h2>
              <p className="ideas-subtitle">Capture content ideas. When ready, click "Start" to move them into production.</p>
            </div>
            <Button variant="primary" onClick={() => setIsAdding(true)}><PlusIcon /> Add Idea</Button>
          </div>
          {isAdding && (
            <form className="ideas-form" onSubmit={handleSubmit}>
              <div className="ideas-form-row">
                <input type="text" value={newIdea.title} onChange={(e) => setNewIdea((prev) => ({ ...prev, title: e.target.value }))} placeholder="What's your idea?" className="ideas-form-input" autoFocus />
                <div className="ideas-form-type">
                  <button type="button" className={`ideas-type-btn ${newIdea.type === 'long-form' ? 'active long' : ''}`} onClick={() => setNewIdea((prev) => ({ ...prev, type: 'long-form' }))}>Long</button>
                  <button type="button" className={`ideas-type-btn ${newIdea.type === 'short-form' ? 'active short' : ''}`} onClick={() => setNewIdea((prev) => ({ ...prev, type: 'short-form' }))}>Short</button>
                </div>
              </div>
              <textarea value={newIdea.description} onChange={(e) => setNewIdea((prev) => ({ ...prev, description: e.target.value }))} placeholder="Brief description (optional)" className="ideas-form-textarea" rows={2} />
              <div className="ideas-form-tags">
                {CONTENT_TAGS.map((tag) => (
                  <button key={tag} type="button" className={`ideas-tag-btn ${newIdea.tags.includes(tag) ? 'active' : ''}`} onClick={() => handleTagToggle(tag)}>{tag}</button>
                ))}
              </div>
              <div className="ideas-form-actions">
                <Button type="button" variant="ghost" onClick={() => setIsAdding(false)}>Cancel</Button>
                <Button type="submit" variant="primary">Save Idea</Button>
              </div>
            </form>
          )}
          <div className="ideas-sections">
            <div>
              <h3 className="ideas-section-title"><span className="ideas-section-dot short" />Short-form Ideas<span className="ideas-section-count">{shortFormIdeas.length}</span></h3>
              <div className="ideas-grid">
                {shortFormIdeas.map((idea) => <IdeaCard key={idea.id} idea={idea} onPromote={onPromote} onDelete={onDelete} />)}
                {shortFormIdeas.length === 0 && <div className="ideas-empty">No short-form ideas yet</div>}
              </div>
            </div>
            <div>
              <h3 className="ideas-section-title"><span className="ideas-section-dot long" />Long-form Ideas<span className="ideas-section-count">{longFormIdeas.length}</span></h3>
              <div className="ideas-grid">
                {longFormIdeas.map((idea) => <IdeaCard key={idea.id} idea={idea} onPromote={onPromote} onDelete={onDelete} />)}
                {longFormIdeas.length === 0 && <div className="ideas-empty">No long-form ideas yet</div>}
              </div>
            </div>
          </div>
        </div>
      );
    };

    const Sidebar = ({ activeView, onViewChange, contentCounts }) => {
      const { user, signOut, isAdmin } = useAuth();
      const navItems = [
        { id: 'pipeline', label: 'Pipeline', icon: <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><rect x="2" y="3" width="5" height="14" rx="1" stroke="currentColor" strokeWidth="1.5"/><rect x="7.5" y="6" width="5" height="11" rx="1" stroke="currentColor" strokeWidth="1.5"/><rect x="13" y="3" width="5" height="14" rx="1" stroke="currentColor" strokeWidth="1.5"/></svg> },
        { id: 'calendar', label: 'Calendar', icon: <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><rect x="2" y="4" width="16" height="13" rx="2" stroke="currentColor" strokeWidth="1.5"/><path d="M2 8h16M6 2v4M14 2v4" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/></svg> },
        { id: 'ideas', label: 'Ideas', icon: <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M10 2a6 6 0 014 10.5V14a1 1 0 01-1 1H7a1 1 0 01-1-1v-1.5A6 6 0 0110 2z" stroke="currentColor" strokeWidth="1.5"/><path d="M7 17h6M8 19h4" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/></svg> },
      ];

      const handleSignOut = async () => {
        await signOut();
      };

      return (
        <aside className="sidebar">
          <div className="sidebar-brand">
            <Logo size={36} showText={true} />
          </div>
          <nav className="sidebar-nav">
            {navItems.map((item) => (
              <button key={item.id} className={`sidebar-nav-item ${activeView === item.id ? 'active' : ''}`} onClick={() => onViewChange(item.id)}>
                <span className="sidebar-nav-icon">{item.icon}</span>
                <span className="sidebar-nav-label">{item.label}</span>
                {contentCounts?.[item.id] > 0 && <span className="sidebar-nav-count">{contentCounts[item.id]}</span>}
              </button>
            ))}
            {isAdmin && (
              <button className={`admin-nav-item ${activeView === 'admin' ? 'active' : ''}`} onClick={() => onViewChange('admin')}>
                <span className="sidebar-nav-icon">
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <circle cx="10" cy="6" r="3" stroke="currentColor" strokeWidth="1.5"/>
                    <path d="M4 17c0-3.3 2.7-6 6-6s6 2.7 6 6" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/>
                    <path d="M15 3l1 1-3 3-1-1 3-3z" fill="currentColor"/>
                  </svg>
                </span>
                <span className="sidebar-nav-label">Admin</span>
              </button>
            )}
          </nav>
          <div className="sidebar-section">
            <h3 className="sidebar-section-title">Content Types</h3>
            <div className="sidebar-type-item"><span className="sidebar-type-dot" style={{ background: '#3b82f6' }} /><span>Long-form</span></div>
            <div className="sidebar-type-item"><span className="sidebar-type-dot" style={{ background: '#f59e0b' }} /><span>Short-form</span></div>
          </div>
          <div className="sidebar-user">
            <div className="sidebar-user-info">
              <UserAvatar email={user?.email} size={32} editable={true} />
              <span className="sidebar-user-email">{user?.email}</span>
            </div>
            <div style={{ display: 'flex', gap: 'var(--space-xs)', flexDirection: 'column' }}>
              <button className="help-btn" onClick={() => onViewChange('help')}>
                <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
                  <circle cx="10" cy="10" r="8" stroke="currentColor" strokeWidth="1.5"/>
                  <path d="M7.5 7.5a2.5 2.5 0 114 2c-.5.5-1 1-1 1.5v.5" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/>
                  <circle cx="10.5" cy="14" r="0.75" fill="currentColor"/>
                </svg>
                Help Guide
              </button>
              <Button variant="ghost" size="sm" onClick={handleSignOut}>
                <LogoutIcon /> Sign Out
              </Button>
            </div>
          </div>
        </aside>
      );
    };

    const Header = ({ onExport, onImport }) => {
      const handleImport = () => {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.onchange = (e) => {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (event) => onImport(event.target.result);
            reader.readAsText(file);
          }
        };
        input.click();
      };

      return (
        <header className="header">
          <div className="header-left">
            <div className="header-logo">
              <Logo size={32} />
              <span className="header-title">Content Calendar</span>
            </div>
          </div>
          <div className="header-right">
            <Button variant="ghost" size="sm" onClick={handleImport}>Import</Button>
            <Button variant="ghost" size="sm" onClick={onExport}>Export</Button>
          </div>
        </header>
      );
    };

    const MainApp = () => {
      const [activeView, setActiveView] = useState('pipeline');
      const [modalOpen, setModalOpen] = useState(false);
      const [selectedContent, setSelectedContent] = useState(null);

      const { user } = useAuth();
      const { markContentRead, markIdeasRead, getUnreadContentCount, getUnreadIdeasCount } = useReadStatus();
      const { content, ideas, team, addContent, updateContent, deleteContent, moveContent, addIdea, deleteIdea, promoteIdea, exportData, importData } = useContentStore();

      // Mark items as read when viewing each section
      useEffect(() => {
        if (!user?.email) return;

        if (activeView === 'pipeline' || activeView === 'calendar') {
          // Mark all current pipeline content as read
          const contentIds = content.filter(c => c.stage !== 'published').map(c => c.id);
          if (contentIds.length > 0) {
            markContentRead(user.email, contentIds);
          }
        } else if (activeView === 'ideas') {
          // Mark all current ideas as read
          const ideaIds = ideas.map(i => i.id);
          if (ideaIds.length > 0) {
            markIdeasRead(user.email, ideaIds);
          }
        }
      }, [activeView, user?.email]);

      const handleCardClick = (item) => { setSelectedContent(item); setModalOpen(true); };
      const handleAddClick = () => { setSelectedContent(null); setModalOpen(true); };
      const handleSave = (formData) => {
        if (selectedContent?.id) { updateContent(selectedContent.id, formData); }
        else { addContent(formData); }
        setModalOpen(false);
      };
      const handleDelete = (id) => { deleteContent(id); setModalOpen(false); };
      const handleImport = (jsonData) => {
        if (importData(jsonData)) { alert('Data imported successfully!'); }
        else { alert('Failed to import data. Please check the file format.'); }
      };

      // Count unread items for notifications
      const unreadCounts = {
        pipeline: getUnreadContentCount(user?.email, content),
        ideas: getUnreadIdeasCount(user?.email, ideas)
      };

      const renderView = () => {
        switch (activeView) {
          case 'pipeline':
            return <PipelineBoard content={content} onCardClick={handleCardClick} onMoveContent={moveContent} onAddClick={handleAddClick} />;
          case 'calendar':
            return <MonthView content={content} onCardClick={handleCardClick} onAddClick={handleAddClick} />;
          case 'ideas':
            return <IdeasBank ideas={ideas} onAddIdea={addIdea} onPromote={promoteIdea} onDelete={deleteIdea} />;
          case 'admin':
            return <AdminPortal />;
          case 'help':
            return <HelpGuide onClose={() => setActiveView('pipeline')} />;
          default:
            return null;
        }
      };

      return (
        <div className="app">
          <Sidebar activeView={activeView} onViewChange={setActiveView} contentCounts={unreadCounts} />
          <Header onExport={exportData} onImport={handleImport} />
          <main className="main-content">
            <div className="page-content">{renderView()}</div>
          </main>
          <Modal isOpen={modalOpen} onClose={() => setModalOpen(false)} title={selectedContent?.id ? 'Edit Content' : 'New Content'}>
            <ContentForm content={selectedContent} team={team} onSave={handleSave} onDelete={handleDelete} onClose={() => setModalOpen(false)} />
          </Modal>
        </div>
      );
    };

    const App = () => {
      const { user, loading } = useAuth();

      if (loading) {
        return (
          <div className="loading-page">
            <span className="loading-spinner" style={{ width: 40, height: 40 }} />
            <p>Loading...</p>
          </div>
        );
      }

      return user ? <MainApp /> : <AuthPage />;
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(
      <ProfilePicsProvider>
        <ReadStatusProvider>
          <AuthProvider>
            <App />
          </AuthProvider>
        </ReadStatusProvider>
      </ProfilePicsProvider>
    );
  </script>
</body>
</html>
